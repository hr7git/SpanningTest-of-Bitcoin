---
title: "reression"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## SRP

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:



```{r,echo=FALSE,message=FALSE }

library(dplyr)
library(readr)
library(car)
# library(lmtest)
library(tidyverse)
library(data.table)
library(knitr)
library(stringr)
library(interactions)
library(jtools)
library("ggplot2")
# library(kableExtra)
```


```{r, render = 'normal_print' }
#######################################################
# 3-2. impact of covid19
# 
# total 5 years : 2017.01 ~ 2021.12
# 
# before covid19 : 2017.01 ~ 2019.12
# 
# after covid19 : 2020.01 ~ 2021.12
#######################################################

#######################################################
# total 5 years : 2017.01 ~ 2021.12
# Bitcoin 
# HK test
# 2 step test

# ethereum 
# HK test
# 2 step test

# Bnb-coin 
# HK test
# 2 step test

# Bicoin + ethereum + Bnbcoin 
# HK test
# 2 step test

# CMC Crypto 200
# HK test
# 2 step test
#######################################################
# for loop ###########################################

# for loop ###########################################

data01 <- read.csv("data1225.csv")
data01 <- data01 %>% select(Date , contains("TNX"), ends_with("R")) 
data02 <- data01 %>% filter(Date < '2020-01-01') %>% 
               select(Date , contains("TNX"), ends_with("R")) 
data03 <- data01 %>% filter(Date >= '2020-01-01') %>%
               select(Date , contains("TNX"), ends_with("R"))
data_j <- list(data01,data02,data03)



formula <- list(); formula_con <- list()

model      <- list(list(),list(),list())  
model_con  <- list(list(),list(),list()) 
HK_test    <- list(list(),list(),list())  
step1_test <- list(list(),list(),list()) 
step2_test <- list(list(),list(),list()) 

yi <- list("BTCUSDR","ETHUSDR","BNBUSDR")

#  list_data <- list(yi, data_j)

# for (i in 1:3)
# {
#   print (list_data[[1]][[i]])
#   # runs uptil the length of inner lists at ith indices
#   for (j in 1:3)
#   {
#     cat ("List", i, "element", j, ": ")
#    print( class(list_data[[2]][[j]])  )
#   }
# }


for (i in 1:3)  {
    for (j in 1:3) {
      

    formula[[i]] = paste0(yi[i] , " ~ ", "VTIR + VVR + VBR + IDHQR + VWOR + BNDR",
                 "+ TIPR + GSGR + VNQR + VNQIR")
                
    model[[i]][[j]] <- lm(formula[[i]], data = data_j[[j]])  ###
    
    ##### HK test
    lhs <- rbind(c(1,0,0,0,0,0,0,0,0,0,0),c(0,1,1,1,1,1,1,1,1,1,1))
    HK_test[[i]][[j]] <- lht(model[[i]][[j]],lhs,c(0,1))
   
    ##### step-1 test  : alpha = 0
    lhs <- c(1,0,0,0,0,0,0,0,0,0,0)
    step1_test[[i]][[j]] <- lht(model[[i]][[j]],lhs,c(0))
    
    ##### step- test 2 : 
    ##### unresrticted model condition on alpha =0  
    formula_con[[i]] = paste0(yi[i] , " ~ ","0 + ", "VTIR + VVR + VBR + IDHQR ",
                          "+ VWOR + BNDR + TIPR + GSGR + VNQR + VNQIR")
        model_con[[i]][[j]] <- lm(formula_con[[i]], data = data_j[[j]])
        ##### step- test 2 : beta=1 condition alpha = 0
        lhs <- rbind(c(1,1,1,1,1,1,1,1,1,1))
        step2_test[[i]][[j]] <- lht(model_con[[i]][[j]],lhs,c(1))
    }
}



c1 <- c("BTCUSDR","ETHUSDR","BNBUSDR")

# names(model) <- c1
# names(model_con) <- c1
# names(HK_test) <- c1
# names(step1_test) <- c1
# names(step2_test) <- c1
# 

formula[[1]]

model[[1]][[1]]$terms
# model[[1]][[2]]$terms
# model[[1]][[3]]$terms
# model[[2]][[1]]$terms
# model[[2]][[2]]$terms
# model[[2]][[3]]$terms
# model[[3]][[1]]$terms
# model[[3]][[2]]$terms 
# model[[3]][[3]]$terms

summary(model$BTCUSDR)
summary(model$ETHUSDR)
summary(model$BNBUSDR)

for (i in 1:3)  {
  
  formula[[i]]
  for (j in 1:3) {
    
    print( HK_test[[i]][[j]]  )
    print( step1_test[[i]][[j]]  )
     step2_test[[i]][[j]]  
   
     }
}


print(HK_test)
kable(HK_test)

print(step1_test)
kable(step1_test)

print(step2_test)
kable(step2_test)



#########################################################
#############################################################################
#########################################################
#########################################################
#########################################################
#########################################################

# test Bitcoin-usd
data01 <- read.csv("data1225.csv")
# Bitcoin ###########################################
btc.ols <- lm(BTCUSDR ~ VTIR + VVR + VBR + IDHQR + VWOR + BNDR + TIPR + 
             GSGR + VNQR + VNQIR
           , data = data01)
summary(btc.ols)

##### HK test
lhs <- rbind(c(1,0,0,0,0,0,0,0,0,0,0),c(0,1,1,1,1,1,1,1,1,1,1))
btc.hk <- lht(btc.ols,lhs,c(0,1))
btc.hk

##### step- test 1 : alpha = 0
lhs <- c(1,0,0,0,0,0,0,0,0,0,0)
btc.step1 <- lht(btc.ols,lhs,c(0))
btc.step1
##### step- test 2 : 
##### unresticted : regression with alpha = 0 
btc.ols2 <- lm(BTCUSDR ~ 0 +VTIR + VVR + VBR + IDHQR + VWOR + BNDR + TIPR + 
             GSGR + VNQR + VNQIR
           , data = data01)
summary(btc.ols2)

lhs <- rbind(c(1,1,1,1,1,1,1,1,1,1))
btc.step2 <- lht(btc.ols2,lhs,c(1))
btc.step2           

summ(btc.ols,  digit = 3)  # unrestricted regression
summ(btc.ols2,  digit = 3)  # unrestricted regression on condition alpha = 0
kable(list( coef(btc.ols),coef(btc.ols2) )) # coefficient 

kable(btc.hk)             # HK test, alpha = 0 and beta = 1
kable(btc.step1)          # step test 1, alpha = 0
kable( btc.step2 )        # step test 2, beta = 1 on condition alpha = 0

plot_summs(btc.ols, scale = TRUE, plot.distributions = TRUE, inner_ci_level = .9)
plot_summs(btc.ols, btc.ols2, scale = TRUE)

export_summs(btc.ols, btc.ols2, scale = TRUE)
# btc.step2 %>%
#   kbl() %>%
#   kable_material_dark()

######################################################
#
#   wald_regress(y) <- function(y) { }
#
######################################################


btc.ols <- lm(BTCUSDR ~ VTIR + VVR + VBR + IDHQR + VWOR + BNDR + TIPR + 
             GSGR + VNQR + VNQIR
           , data = data01)
summary(btc.ols)

##### HK test
lhs <- rbind(c(1,0,0,0,0,0,0,0,0,0,0),c(0,1,1,1,1,1,1,1,1,1,1))
btc.hk <- lht(btc.ols,lhs,c(0,1))
btc.hk

##### step- test 1 : alpha = 0
lhs <- c(1,0,0,0,0,0,0,0,0,0,0)
btc.step1 <- lht(btc.ols,lhs,c(0))
btc.step1
##### step- test 2 : 
##### unresticted : regression with alpha = 0 
 # BTCUSDR  <- yi 
btc.ols2 <- lm(BTCUSDR ~ 0 +VTIR + VVR + VBR + IDHQR + VWOR + BNDR + TIPR + 
             GSGR + VNQR + VNQIR
           , data = data01)
summary(btc.ols2)

lhs <- rbind(c(1,1,1,1,1,1,1,1,1,1))
btc.step2 <- lht(btc.ols2,lhs,c(1))
btc.step2           

summ(btc.ols,  digit = 3)  # unrestricted regression
summ(btc.ols2,  digit = 3)  # unrestricted regression on condition alpha = 0
kable(list( coef(btc.ols),coef(btc.ols2) )) # coefficient 

kable(btc.hk)             # HK test, alpha = 0 and beta = 1
kable(btc.step1)          # step test 1, alpha = 0
kable( btc.step2 )        # step test 2, beta = 1 on condition alpha = 0

plot_summs(btc.ols, scale = TRUE, plot.distributions = TRUE, inner_ci_level = .9)
plot_summs(btc.ols, btc.ols2, scale = TRUE)

export_summs(btc.ols, btc.ols2, scale = TRUE) 





# eterrium ###########################################
olseth <- lm(ETHUSDR ~ VTIR + VVR + VBR + IDHQR + VWOR + BNDR + TIPR + 
             GSGR + VNQR + VNQIR
           , data = data01)
summary(olseth)
##### HK test
lhs <- rbind(c(1,0,0,0,0,0,0,0,0,0,0),c(0,1,1,1,1,1,1,1,1,1,1))
lht(olseth,lhs,c(0,1))
##### 2 step- test
lhs <- c(1,0,0,0,0,0,0,0,0,0,0)
lht(olseth,lhs,c(0))


# bnb coin ############################################
olsbnb <- lm(BNBUSDR ~ VTIR + VVR + VBR + IDHQR + VWOR + BNDR + TIPR + 
             GSGR + VNQR + VNQIR
           , data = data01)
summary(olsbnb)
##### HK test
lhs <- rbind(c(1,0,0,0,0,0,0,0,0,0,0),c(0,1,1,1,1,1,1,1,1,1,1))
lht(olsbnb,lhs,c(0,1))
##### 2 step- test
lhs <- c(1,0,0,0,0,0,0,0,0,0,0)
lht(olsbnb,lhs,c(0)) 


# cypto joint ############################################
olscypto <- lm(BTCUSDR + ETHUSDR + BNBUSDR ~ VTIR + VVR + VBR + IDHQR + 
                 VWOR + BNDR + TIPR + 
             GSGR + VNQR + VNQIR
           , data = data01)
summary(olscypto)
##### HK test
lhs <- rbind(c(1,0,0,0,0,0,0,0,0,0,0),c(0,1,1,1,1,1,1,1,1,1,1))
lht(olscypto,lhs,c(0,1))
##### 2 step- test
lhs <- c(1,0,0,0,0,0,0,0,0,0,0)
lht(olscypto,lhs,c(0)) 

   #######################################################
   # before covid19 : 2017.01 ~ 2019.12
   #######################################################  
  data_before <- data01 %>% 
    filter(Date < '2020-01-01') %>% 
      select(Date , contains("TNX"), ends_with("R"))   # select only ratio-column
    # tail(data_before) 
    ols0 <- lm(BTCUSDR ~ VTIR + VVR + VBR + IDHQR + VWOR + BNDR + TIPR + 
               GSGR + VNQR + VNQIR
             , data = data_before)
    summary(ols0)
  
    lhs <- rbind(c(1,0,0,0,0,0,0,0,0,0,0),c(0,1,1,1,1,1,1,1,1,1,1))
    lht(ols0,lhs,c(0,1)) 
    
    ##### 2 step- test
    lhs <- c(1,0,0,0,0,0,0,0,0,0,0)
    lht(ols0,lhs,c(0)) 

    #######################################################
    # after covid19 : 2020.01 ~ 2021.12
    #######################################################  
    data_before <- data01 %>% 
      filter(Date >= '2020-01-01') %>% 
      select(Date , contains("TNX"), ends_with("R"))   # select only ratio-column
    # tail(data_before) 
    ols0 <- lm(BTCUSDR ~ VTIR + VVR + VBR + IDHQR + VWOR + BNDR + TIPR + 
                 GSGR + VNQR + VNQIR
               , data = data_before)
    summary(ols0)
    
    lhs <- rbind(c(1,0,0,0,0,0,0,0,0,0,0),c(0,1,1,1,1,1,1,1,1,1,1))
    lht(ols0,lhs,c(0,1))
    ##### 2 step- test
    lhs <- c(1,0,0,0,0,0,0,0,0,0,0)
    lht(ols0,lhs,c(0))    
    
######################################################
######################################################
# csvfile <-"DATA/^IRX.csv"
# col_name <- str_sub(csvfile, -7, -5)
# write_name <- str_sub(csvfile, -7, -1)
# # Store the csv file into the data frame of "df"
# df <- read.csv(csvfile)[ ,c("Date", "Adj.Close")]
# 
# 
# colnames(df)[2] <- col_name
# 
# write.csv(df,write_name,row.names=FALSE)
# 
# # Show the first five rows
# kable(head(df,5),
#       caption = "data.frame - df",
#       align = c("r"))

# df01 <- transmute(df,
#           Date = Date,
#           BTC = ( BTC - shift(BTC)) / shift(BTC) * 100 - Tbill,
#           DBC = ( DBC - shift(DBC)) / shift(DBC) * 100 - Tbill,
#           GLD = ( GLD - shift(GLD)) / shift(GLD) * 100 - Tbill,
#           QQQ = ( QQQ - shift(QQQ)) / shift(QQQ) * 100 - Tbill,
#           SPY = ( SPY - shift(SPY)) / shift(SPY) * 100 - Tbill,
#           TLT = ( TLT - shift(TLT)) / shift(TLT) * 100 - Tbill)
# # head(df01)
# kable(head(df01),
#       caption = "dataframe - df01",
#       align = c("r","r","r","r","r","r","r"))



```