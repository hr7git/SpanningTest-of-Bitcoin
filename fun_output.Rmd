---
title: "Impact OF Covid-19 to Bitcoin"
output:
  html_document: default
  word_document: default
  pdf_document: default
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r ,echo=FALSE,message=FALSE}

library(readr)
# library(lmtest)
library(tidyverse)
library(data.table)
library(knitr)
library(stringr)
library(readxl)


library(quantmod)  # getsymbols
library(PerformanceAnalytics)
library(magrittr)
library(car)  # lht
library(tidyr)
library(dplyr)
```


<center>**Impact OF Covid-19 to Bitcoin**</center>

<center>**: Spanning Test of cryptocurrency **</center><br>


<br><center>**1.	Introduction**</center><br>

  Bitcoin is a decentralized digital money based on blockchain technology. It was born out of the need to maintain an objective currency value, independent of government control. Since the global financial crisis (2008), each country has increased money supply called Quantitative Easing (QE), and the rapid increase in fiat money has caused strong distrust of the government's monetary control and concerns about inflation. Therefore, the need for a new currency that is independent from the government's supply and cannot be issued infinitely increased, and Nakamoto (2009) created the cryptocurrency Bitcoin. Unfortunately, since the covid-19 pandemic in 2020, Quantitative Easing (QE) has led to currency depreciation and increased expectation for Bitcoin. Recently, the value of Bitcoin has risen sharply incomparably with the previous period.

  These expectations for Bitcoin have made comparisons with gold, a traditional safe-haven asset. Can Bitcoin really hedge against inflation from the government's Quantitative Easing (QE) policy? Can Bitcoin be a safe haven from market turmoil and uncertainties? Many studies have argued that Bitcoin is a short-term or not safe-haven for financial uncertainty and weak inflation-hedge. In addition, High volatility of returns has made it a risky asset. (Choi, S. and Shin, J. ,2021)

Fortunately, since Markowitz (1959) expressed the foundations for the modern portfolio theory, investors have come to recognize that a correlation between assets is more important than volatility of assets, and they realize that volatility can be reduced without compromising returns. Bitcoin can be a very risky investment due to its high volatility, but under Markowitz theory, the risk can be adjusted through the correlation with other assets. So far, stocks and real estate have a high correlation with each other, and stocks and bonds have a low correlation of 0.2 ~ 0.3. However, Bitcoin has very high volatility even in its short history, and has a correlation of 0.2 ~ 0.3 compared to the existing stock portfolio, and that correlation is getting lower now (Buttonwood, 2021). On the other hand, it shows profitability that exceeds that of bonds. Although past data cannot describe future expectations, these characteristics of Bitcoin can make it a very attractive alternative choice for portfolio managers.

Then, could these other characteristics make Bitcoin a completely different asset from traditional assets such as stocks, bonds, commodities, gold, and real estate?  In other words, if Bitcoin is added to an existing portfolio of assets, can it improve portfolio output? How can we verify this?

We examine whether new risky assets can expand investment opportunities for other sets of risky assets, and examine that when investors choose a portfolio based on mean-variance analysis, they can expand minimum-variance boundaries in a given set of risky assets (Huberman and Kandel, 1987).

The structure of this paper is as follows. Chapter2 reviews the papers examining the characteristics of Bitcoin by comparing cryptocurrency and gold, and papers examining the addition of new assets in investment portfolio theory. Chapter 3 explains the methodology used by Huberman and Kandel (1987) to compare the possibility of investment expansion when Bitcoin is included in the portfolio. Chapter 4 describes the results of empirical analysis. Chapter 5 presents a summary and conclusion  


<br><center>**2.	Literature review**</center><br>
  
  
<br><center>**3.  Methodology**</center><br> 

**3-1. Regression model **
Huberman and Kandel (1987) describes that a set of K assets spans a set of N + K assets if the minimum-variance frontier of the K assets is equal to the minimum-variance frontier of the K assets plus N assets.  

$$rt = Œ± +Œ≤Rt +Œµt$$(1) <br>



Regression analysis is performed using the equation (1), As a regression method, the Wald test evaluates constraints on statistical parameters based on weighted distances between unconstrained estimates and hypothesized values. In equation (1), the variable rt is the return vector (N-dimensional vector) of N test assets in period t, and the variable Rt is the return vector (K-dimensional vector) of t K benchmark assets in period t.  If the null hypothesis (2) is rejected, Bitcoin can expand the investment opportunities. 

**3-2. Wald test : Hypothesis of restricted model  **
<!-- wald test methos must me wiritten in this part, specially  unresticted model of stpe2 is (intercept)=0  -->

1) HK test :     $Œ± = 0N$     and    $\gamma = iN - Œ≤iK = 0$

2) step test 1 : $Œ± = 0N$

3) step test 2 : $ùõæ = iN - Œ≤iK = 0$  <br>
   condition on  $Œ± = 0N$   
   When making unrestricted model, intercept = 0 must me added


**3-3. Impact of covid19 Analysis period**

1) total 5 years  : 2017.01 ~ 2021.12

2) before covid19 : 2017.01 ~ 2019.12

3) after covid19  : 2020.01 ~ 2021.12


  
  
<br><center>**4.  Data**</center><br>


A set of K risky assets makes a benchmark portfolio using stocks, bonds, commodities, and gold; a set of K risky assets uses Bitcoin. Data uses the final value of one month cycle from April 28, 2013, when Bitcoin was recorded at finance.yahoo.com.

The tickers of the benchmark assets are as follows: Bitcoin : Bitcoin USD (BTC-USD) Stocks : 

<!-- Risk free T-bill : Market Yield on U.S. Treasury Securities at 10-Year Constant Maturity, Percent, Weekly, Not Seasonally Adjusted (DGS10) (https://fred.stlouisfed.org/series/DGS10#0,12/24/2021) -->

Risk free T-bill : US Treasury Bonds Rates - 13 Week Treasury Bill (^IRX : ticker of finance.yahoo)


**4.1 Test Assets**  

  Test asset was selected Bitcoin and Ethereum, which account for the top 60% of market cap (December 22, 2022) among cryptocurrencies. The value of Bitcoin is the adjusted daily price  from April 28, 2013 recorded by finance.yahoo.com. The value of Ethereum is also adjusted daily price from August 7, 2015, but it were sliced from Jan 1, 2017 to analyse recent 5 years.  
 
Table 4.1 Summary of Cyptocurrency (Dec 22,2021)

  Market Rank|Ticker |Name     |Start Date  |Market Cap |Market Dominance 
 :---:    | :---   | :---   | :---        | ---:       | ---:              
 #1       |BTC-USD |Bitcoin      | 2009-01-03  | 925.017B   | 40.57% 
 #2       |ETH-USD |Ethereum     | 2015-07-30  | 476.975B   | 20.87% 
 #3       |BNB-USD |Binance Coin | 2017-07-25  | 88.777B    | 3.89%    
 

**4.2 Benchmark Portfolio**  

  1. correlation graph of assets 
  

correlation between asset : --> change another graph

```{r}
library(dplyr)
library(corrplot)
  load("rets2.Rdata")
  
cor(rets2) %>%
  corrplot(method = 'color', type = 'lower',
           addCoef.col = 'black', number.cex = 0.7,
           tl.cex = 1, tl.srt = 0, tl.col = 'black',
           col = colorRampPalette(c('blue', 'white', 'red'))(200),
           mar = c(0,0,0.5,0))

```

  
  2. SPY, TLT, GLD choosed ( GLD : psudo money)
  
  3. regression assets

  The benchmark portfolio selected asset allocations of HMC Portfolio : we should replicating it with accessible instruments by ETF.

</br>Table 4.2 Asset allocations of Harvard Univ Portfolio Set 
```{r,echo=FALSE,message=FALSE }

df_table <- read_excel("C:/Users/hanap/Dropbox/ak2424/KD/1. SRP/r_test/portfolios.xlsx",sheet = "harvard")

kable(head(df_table,12),
      caption = "Harvard Management Company Portfolio",
      align = "lll")
``` 

<Table 4.2> shows Harvard University's fund portfolio comprising stocks, bonds, and real estate. To represent these assets, the ETF portfolio in Table 4.3 is used as a benchmark asset set. SPDR S&P 500 ETF Trust (SPY) Bonds : iShares 1-3 Year Treasury Bond ETF (SHY) Commodities : Invesco DB Commodity Index Tracking Fund (DBC) Gold : SPDR Gold Shares (GLD) 
</br>Table 4.3 Asset allocations of Benchmark Portfolio Set  

```{r,echo=FALSE,message=FALSE }

df_table <- read_excel("C:/Users/hanap/Dropbox/ak2424/KD/1. SRP/r_test/portfolios.xlsx",sheet = "benchmark_set")

kable(head(df_table,12),
      caption = "Benchmark Test Asset",
      align = c("c","l","l","l"))

```
ETF is the price from yahoo.finance. For more details on price see <http://finance.yahoo.com>.  
<br><br>


<br><center>**5.  Results**</center><br>


Q - bench asset --> SPY TLT GLD only ( stock bond + GLD:becuase of psudeo money character)
Q - period --> all / before & after covid19
Q - Heteroskedecity option before/after apply - change the probability
Q - test portfolio (1.BTC / 2.ETH / 3.BTC+ETH)
Q - SSR / SST --> wald test option ( equation verify)

Q2 - test:BTC+ETH / bench: as add assets / data: after covid19
    -  after add IEF : significantly different

1. BTC result

1) Period 2014 ~ 2022.2
```{r,echo=FALSE,message=FALSE}
  library(huxtable)
  load("rets2.Rdata")
  load("df_base2.Rdata")
  load("df_hetero.Rdata")
  ####
  kable(head(df_base2,12),
      caption = "wald test - base",
      align = c("l","l","l"))
  kable(head(df_hetero,12),
      caption = "wald test - hetero",
      align = c("l","l","l"))
  hux(df_hetero)
```


  coefficient of GLD is 0.412282 p-value is 0.00348 is siginicant 1% level
  
2) period 2014 ~ 2019 : Before covid19
  Coefficients:
             Estimate Std. Error t value Pr(>|t|)
GLD          0.329442   0.191074   1.724    0.085 .
   p values is insigincant 5% level
3) period 2020 ~ 2022.2 : After covid19

4) Q2 - test:BTC+ETH / bench: as add assets / data: after covid19
    -  after add IEF : Pr >  0.05 - benchmark set can span test set
    -  it means if we make portfolis with SPY TLT IEF GLD, then it can span BTC ETH set
```{r,echo=FALSE,message=FALSE}

  load("df_bench.Rdata")
  ####
  kable(head(df_bench,12),
      caption = "Bench data set",
      align = c("l","l","l"))

```    

5) mean-variance efficient frontier graph
    - BTC ETH / SPY TLT GLD IEF

  
<center>**References**</center><br>
  
  Berndt, E. R. and N.E. Savin, 1977, ‚ÄúConflict among criteria for testing hypotheses in the multivariate	 linear regression model‚Äù. Econometrica 45, pp. 1263‚Äì1278
  
Buttonwood, 2021, ‚ÄúWhy it is wise to add bitcoin to an investment portfolio‚Äù, The Economist, Sep	 25th 2021 edition

Choi, S., & Shin, J. (2021). ‚ÄúBitcoin: An inflation hedge but not a safe haven.‚Äù Finance Research		 Letters,102379.

Eugene Fama, ‚ÄúRisk, Return and Equilibrium.‚Äù Journal of Political Economy 79 (January 1971)  
Huberman, G. and Kandel, S., 1987, ‚ÄúMean-variance spanning‚Äù, Journal of Finance 42, pp. 873~888.  
Hwang, Y. (2019). ‚ÄúBitcoin (Gold)‚Äôs Hedge‚Ä§ Safe-Haven‚Ä§ Equity‚Ä§ Taxation.‚Äù Journal of Society for	 e-Business Studies, 23(3).  
Lee,J S. 2018, ‚ÄúPerformance Evaluation of Social Responsibility Investment using MSCI Indexes‚Äù, 	Applied Economics Vol.20, No. 2, Jun 2018 edition  
Kan, R. and Zhou, G., 2012, ‚ÄúTest of mean-variance spanning‚Äù, Annals of Economics and Finance	  13-1, pp. 145~193.  
Markowitz, Harry M. (1959). ‚ÄúPortfolio Selection: Efficient Diversification of Investments.‚Äù John	 Wiley & Sons, New Jersey  
Nakamoto, Satoshi.,2009 "Bitcoin: A peer-to-peer electronic cash system." Decentralized Business	 Review 21260.  
Sharp et al. (1964), ‚ÄúCapital Asset Prices: A Theory of Market Equilibrium‚Äù, Journal of Finance,		 September 1964.  
William Sharpe. ‚ÄúCapital Asset Prices: A theory of Market Equilibrium under Conditions of Risk.‚Äù	 Journal of Finance 19 (September 1984)  

Fig1: https://en.wikipedia.org/wiki/Efficient_frontier  
Fig2: Boris, F., Marie, L., Nicolas, P (2020) ‚ÄúRisk Optimizations on Basis Portfolios: The Role	of Sorting‚Äù, An EDHEC-Risk Working Paper, June 2020, pp. 19  


  
<br><center>**Appendix**</center><br>

</br>Table 4.5 The Result of regression test  
```{r,echo=FALSE,message=FALSE }

df_table <- read_excel("Ivy Asset Allocation.xlsx",
                                    sheet = "test")

kable(head(df_table,12),
      caption = "Ivy Asset Allocation.xlsx",
      align = c("l","l","l"))


```  

### 
  1. stock chart of BTC ...
  2. correlations between asset
  3. The Geometry of mean-variancce spanning test
  


```{r}
 library(quantmod)
 load("data_getsymbols.RData")
 chart_Series(rets2$BTC)
 chart_Series(rets2$SPY)
 chart_Series(rets2$GLD)
 ###
 library(plotly)
 SPY %>%
   fortify.zoo %>%
   plot_ly(x= ~Index, y = ~SPY.Close ) %>%
   add_lines()
 
 ###
 ###
 # library(PerformanceAnalytics)
 # library(quantmod)
 library(dygraphs)
 data <- apply.monthly(rets_test,mean)  # montly return
 dygraph(data, main = "Montly Return") %>%
   dyAxis("y", label = "return") %>%
   dyOptions(colors = RColorBrewer::brewer.pal(4, "Set2"))
 ###
 # chartSeries(`BTC`)
 # chartSeries(`ETH`)
```

correlation between asset : 

```{r}
library(dplyr)
library(corrplot)

cor(rets) %>%
  corrplot(method = 'color', type = 'lower',
           addCoef.col = 'black', number.cex = 0.7,
           tl.cex = 1, tl.srt = 0, tl.col = 'black',
           col = colorRampPalette(c('blue', 'white', 'red'))(200),
           mar = c(0,0,0.5,0))

```





### regression i j k
test : i  
  1. BTC-USD  
  2. ETH-USD  
  3. BTC & ETH  
period : j  
  1. all  
  2. before covid19  
  3. after covid19  
method : k  
  1. regression   
  2. regression subject to intercept = 0  
  3. HK test  
  4. Step1 test  
  5. Step2 test  

```{r}
  # load("rets.Rdata")
  # load("data_quant.RData")
  # load("C:/Users/hanap/Dropbox/ak2424/KD/1. SRP/r_test/nn_list.RData")
```


```{r eval=FALSE, echo=FALSE, include=FALSE}

library(huxtable)
library(knitr)
# library(flextable)
#  library(tidyr)
#  nn_list

  load("C:/Users/hanap/Dropbox/ak2424/KD/1. SRP/r_test/nn_list.RData")
  nn_model   <- list()
nn_model2  <- list()
nn_alpha <- list()
nn_beta  <- list()
nn_HK    <- list()
nn_st1   <- list()
nn_st2   <- list()

######################################################################
#    i : 1-BTC / 2-ETH / 3-BTC+ETH
#    j : 1-all / 2-before / 3-after covid19
######################################################################

a <- 0
for ( j in 1:3)  {  # year period
  for ( i in 1:3)  {
  
  a <- a + 1
  nn_model[[a]] <- nn_list[[i]][[j]][[1]] # regression
  nn_model2[[a]] <- nn_list[[i]][[j]][[2]]
  
  ##### regression model_q
  nn_alpha[[a]] <- nn_list[[i]][[j]][[1]]$coefficients[1]   # alpha 
  nn_beta[[a]]  <- sum(nn_list[[i]][[j]][[1]]$coefficients)
  - nn_list[[i]][[j]][[1]]$coefficients[1]  # beta
  
  nn_HK[[a]]   <- nn_list[[i]][[j]][[3]] 
  nn_st1[[a]]  <- nn_list[[i]][[j]][[4]] 
  nn_st2[[a]]  <- nn_list[[i]][[j]][[5]] 
  }
}
  

# nn_model
nn_model
huxreg(nn_model)  # unrestricted model 
huxreg(nn_model2) # alpha = 0

# huxreg(nn_model,nn_list[[1]][[1]])
# nn_list[[1]][[1]][[1]]
# class(nn_model2)
# nn_model2
# flextable(nn_model[[1]])


nn_alpha
kable(nn_alpha)
nn_beta
kable(nn_beta)

nn_HK
nn_st1
nn_st2
kable(nn_HK)
kable(nn_st1)
kable(nn_st2)

# flextable(nn_HK)

```

